<network>
  <name>{{ network_name }}</name>
  {% if ansible_libvirt_networks and network_name in ansible_libvirt_networks %}
    <uuid>{{ansible_libvirt_networks[network_name].uuid}}</uuid>
    <mac address='{{ansible_libvirt_networks[network_name].macaddress}}'/>
  {% endif %}
  <forward mode='nat'>
    <nat>
      <port start='1024' end='65535'/>
    </nat>
  </forward>
  <bridge name='{{network_name}}' stp='on' delay='0'/>
  <ip address='{{network_definition.ip | ipaddr("address")}}' netmask='{{ network_definition.ip|ipaddr("netmask") }}'>
    <dhcp>
      <range start='{{network_definition.dhcp_start}}' end='{{network_definition.dhcp_end}}'/>
      {% if ansible_libvirt_networks and network_name in ansible_libvirt_networks %}
      	{% for host in ansible_libvirt_networks[network_name].dhcp_leases %}
      		<host mac="{{host['mac']}}" name="{{host['hostname']}}" ip="{{host['ipaddr']}}" />
      	{% endfor %}
      {% endif %}
    </dhcp>
  </ip>
</network>
